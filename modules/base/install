#!/usr/bin/env sh
set -e

cmd sudo install -D -m 644 ./pacman.conf /etc/pacman.conf

cmd sudo ln -sf /usr/share/zoneinfo/Asia/Tomsk /etc/localtime
cmd sudo install -D -m 644 "$(writetext "LANG=en_US.UTF-8")" /etc/locale.conf
cmd sudo install -D -m 644 "$(writetext "KEYMAP=dvorak")" /etc/vconsole.conf
cmd sudo install -D -m 644 "$(writetext "arch")" /etc/hostname
cmd sudo install -D -m 644 "$(writetext <<EOF
en_CA.UTF-8 UTF-8
en_CA ISO-8859-1
en_US.UTF-8 UTF-8
en_US ISO-8859-1
ru_RU.KOI8-R KOI8-R
ru_RU.UTF-8 UTF-8
ru_RU ISO-8859-5
EOF
)" /etc/locale.gen

cmd sudo install -D -m 755 "$(writetext <<'EOF'
export XDG_CACHE_HOME="$HOME/.cache";
export XDG_CONFIG_HOME="$HOME/.config";
export XDG_DATA_HOME="$HOME/.local/share";
export XDG_STATE_HOME="$HOME/.local/state";
export PATH="$PATH:$HOME/.local/bin"
export HISTFILE="$XDG_STATE_HOME/bash/history";
export CUDA_CACHE_PATH="$XDG_CACHE_HOME/nv";
export CARGO_HOME="$XDG_DATA_HOME/cargo";
export GOPATH="$XDG_DATA_HOME/go";
export NPM_CONFIG_INIT_MODULE="$XDG_CONFIG_HOME/npm/config/npm-init.js";
export NPM_CONFIG_CACHE="$XDG_CACHE_HOME/npm";
export NPM_CONFIG_TMP="$XDG_RUNTIME_DIR/npm";
EOF
)" /etc/profile.d/dotfiles.sh

cmd sudo usermod -aG wheel,audio,video,input,tty,kvm,network "$(whoami)"
